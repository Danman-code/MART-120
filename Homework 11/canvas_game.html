<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Canvas Game â€” Player & Obstacles (Homework 7)</title>
    <style>
      body{font-family:Arial,Helvetica,sans-serif;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;background:#f3f4f6}
      .wrap{width:860px}
      canvas{background:#fff;display:block;border:1px solid #ccc}
      .hint{font-size:14px;color:#333;margin-top:8px}
      .overlay{position:absolute;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center}
      .winbox{background:rgba(0,0,0,0.75);color:#fff;padding:20px 30px;border-radius:8px;font-size:24px}
    </style>
  </head>
  <body>
    <div class="wrap">
      <div style="position:relative">
        <canvas id="game" width="800" height="600"></canvas>
        <div id="overlay" class="overlay" style="display:none"><div class="winbox">You won! ðŸŽ‰</div></div>
      </div>
      <div class="hint">Use arrow keys or WASD to move the blue player. Click to drop a static obstacle. Reach the green Exit to win.</div>
    </div>

    <script>
      (function(){
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const W = canvas.width, H = canvas.height;

        // Player
        const player = { x:50, y:50, r:14, speed:3.2, color:'#2b6cb0' };

        // Exit area 
        const exit = { x: W-100, y: H-80, w:80, h:60, color:'rgba(40,167,69,0.25)', stroke:'#28a745' };

        // Obstacles 
        const obstacles = [];

        function rand(min,max){ return Math.random()*(max-min)+min }
        function randColor(){ const h = Math.floor(rand(0,360)); return `hsl(${h} 70% 50%)` }

        // 2 moving obstacles of different sizes/colors
        obstacles.push({ x:200, y:120, w:60, h:40, vx:1.2, vy:0.6, color:randColor(), moving:true });
        obstacles.push({ x:420, y:320, w:40, h:70, vx:-0.9, vy:1.1, color:randColor(), moving:true });
        // third obstacle 
        obstacles.push({ x:100, y:420, w:30, h:30, vx:1.6, vy:-1.0, color:randColor(), moving:true });

        // keyboard input
        const keys = {};
        window.addEventListener('keydown', e => { keys[e.key] = true });
        window.addEventListener('keyup', e => { keys[e.key] = false });

        // static obstacle on click
        canvas.addEventListener('click', function(e){
          const rect = canvas.getBoundingClientRect();
          const mx = e.clientX - rect.left;
          const my = e.clientY - rect.top;
          const w = Math.floor(rand(20,60));
          const h = Math.floor(rand(20,80));
          obstacles.push({ x:mx - w/2, y:my - h/2, w, h, vx:0, vy:0, color:randColor(), moving:false });
        });

        let won = false;

        function update(){
          if(won) return; // stop updating when won

          // Player movement uses if/else
          if(keys['ArrowUp'] || keys['w'] || keys['W']){
            player.y -= player.speed;
          } else if(keys['ArrowDown'] || keys['s'] || keys['S']){
            player.y += player.speed;
          }

          if(keys['ArrowLeft'] || keys['a'] || keys['A']){
            player.x -= player.speed;
          } else if(keys['ArrowRight'] || keys['d'] || keys['D']){
            player.x += player.speed;
          }

          // keep player within canvas
          if(player.x < player.r) player.x = player.r;
          if(player.x > W - player.r) player.x = W - player.r;
          if(player.y < player.r) player.y = player.r;
          if(player.y > H - player.r) player.y = H - player.r;

          // Update obstacles: move and wrap-around if they leave the screen
          for(const o of obstacles){
            if(o.moving){
              o.x += o.vx;
              o.y += o.vy;

              // wrap horizontally
              if(o.x > W){
                o.x = -o.w;
              } else if(o.x + o.w < 0){
                o.x = W;
              }

              // wrap vertically
              if(o.y > H){
                o.y = -o.h;
              } else if(o.y + o.h < 0){
                o.y = H;
              }
            }
          }

          // Check if player goes through the exit 
          
          if(player.x > exit.x && player.y > exit.y){
            // inside exit area horizontally and vertically
            if(player.x < exit.x + exit.w && player.y < exit.y + exit.h){
              won = true;
              overlay.style.display = 'flex';
            }
          } else {
            // not inside exit; do nothing
          }
        }

        function draw(){
          ctx.clearRect(0,0,W,H);

          // draw exit
          ctx.fillStyle = exit.color;
          ctx.fillRect(exit.x, exit.y, exit.w, exit.h);
          ctx.strokeStyle = exit.stroke;
          ctx.lineWidth = 2;
          ctx.strokeRect(exit.x, exit.y, exit.w, exit.h);
          ctx.fillStyle = exit.stroke;
          ctx.font = '14px sans-serif';
          ctx.fillText('EXIT', exit.x + 8, exit.y + 20);

          // draw obstacles
          for(const o of obstacles){
            ctx.fillStyle = o.color;
            ctx.fillRect(o.x, o.y, o.w, o.h);
            // small border
            ctx.strokeStyle = 'rgba(0,0,0,0.1)';
            ctx.strokeRect(o.x, o.y, o.w, o.h);
          }

          // draw player
          ctx.beginPath();
          ctx.fillStyle = player.color;
          ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
          ctx.fill();
          ctx.closePath();
        }

        function loop(){
          update();
          draw();
          if(!won) requestAnimationFrame(loop);
        }

        // Start the game loop
        loop();
      })();
    </script>
  </body>
</html>
